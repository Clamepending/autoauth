<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OttoAuth Browser Agent</title>
    <link rel="stylesheet" href="sidepanel.css" />
  </head>
  <body>
    <main class="layout">
      <section class="pairStrip">
        <div class="pairStripHeader">
          <strong>Cloud Agent Pairing</strong>
          <span id="pairingStatusText">Generate a browser token, then give it to your agent once.</span>
        </div>
        <div class="pairStripRow">
          <div id="agentPairToken" class="tokenPill" title="Browser token">No token yet</div>
          <button id="setupTokenBtn" type="button" class="secondary compact">Regenerate</button>
          <button id="copyTokenBtn" type="button" class="secondary compact">Copy</button>
        </div>
      </section>

      <section id="planApprovalCard" class="planApprovalCard hidden" aria-live="polite">
        <div class="planApprovalHeader">
          <div>
            <div class="planApprovalEyebrow">Plan Ready</div>
            <h2>OttoAuth Browser Agent plan</h2>
            <p id="planApprovalSubtitle">Review before the browser agent starts.</p>
          </div>
          <button id="planCardDismissBtn" type="button" class="iconButton secondary compactIcon" title="Dismiss plan card" aria-label="Dismiss plan card">Ã—</button>
        </div>
        <div class="planApprovalBody">
          <div id="planDomainsBlock" class="planBlock hidden">
            <div class="planBlockLabel">Allow actions on these sites</div>
            <div id="planDomainsList" class="domainChipRow"></div>
          </div>

          <div id="planSummaryBlock" class="planBlock hidden">
            <div class="planBlockLabel">Summary</div>
            <div id="planSummaryText" class="planBlockText"></div>
          </div>

          <div id="planStepsBlock" class="planBlock hidden">
            <div class="planBlockLabel">Steps</div>
            <ol id="planStepsList" class="planList ordered"></ol>
          </div>

          <div class="planActionStack">
            <button id="planCardApproveBtn" type="button" class="primary big">Approve plan</button>
            <button id="planCardEditBtn" type="button" class="secondary big">Make changes</button>
          </div>

        </div>
      </section>

      <section class="feedWrap">
        <div class="feedHeader">
          <div class="feedHeaderLeft">
            <select id="modelSelect" class="chatModelSelect" aria-label="Model"></select>
          </div>
          <div class="feedHeaderRight">
            <button id="clearChatBtn" type="button" class="iconButton secondary compactIcon" title="Clear chat" aria-label="Clear chat">
              <svg class="iconGlyph" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M8.5 6.25h7M6.75 8h10.5M9.25 6.25V5.7c0-.94.76-1.7 1.7-1.7h2.1c.94 0 1.7.76 1.7 1.7v.55" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M8.1 8l.55 9.2c.06 1 .89 1.8 1.9 1.8h2.9c1.01 0 1.84-.8 1.9-1.8L15.9 8" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M10.4 10.35v5.2M13.6 10.35v5.2" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
              </svg>
            </button>
            <button id="copyChatDebugBtn" type="button" class="iconButton secondary compactIcon" title="Copy debug transcript" aria-label="Copy debug transcript">
              <svg class="iconGlyph" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M9 9.75A1.75 1.75 0 0 1 10.75 8h7.5A1.75 1.75 0 0 1 20 9.75v9.5A1.75 1.75 0 0 1 18.25 21h-7.5A1.75 1.75 0 0 1 9 19.25z" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linejoin="round"/>
                <path d="M15 8V6.75A1.75 1.75 0 0 0 13.25 5h-7.5A1.75 1.75 0 0 0 4 6.75v9.5A1.75 1.75 0 0 0 5.75 18H9" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <button id="approvePlanBtn" type="button" class="secondary compact hidden" title="Approve plan and start execution">Approve Plan</button>
            <button id="continueMaxBtn" type="button" class="secondary compact hidden" title="Continue this run for another max-step budget">Continue</button>
            <span id="metaText">No run yet</span>
          </div>
        </div>
        <div id="feed" class="feed"></div>
        <section class="composer">
          <textarea id="goalInput" rows="1" placeholder="What should I do in this browser?"></textarea>
          <div class="composerFooter">
            <button id="settingsToggleBtn" type="button" class="iconButton secondary" title="Settings" aria-label="Settings">&#9881;</button>
            <div class="composerActions">
              <select id="approvalModeSelect" class="approvalModeSelect" aria-label="Approval mode">
                <option value="ask_first">Ask before acting</option>
                <option value="act_without_asking">Act without asking</option>
              </select>
              <button id="primaryActionBtn" type="button" class="sendButton iconOnly" title="Send message" aria-label="Send message">
                <span id="primaryActionIcon" aria-hidden="true"></span>
              </button>
            </div>
          </div>
        </section>
      </section>

      <section id="settingsPanel" class="settingsPanel hidden" aria-hidden="true">
        <div class="settingsPanelCard">
          <div class="settingsPanelHeader">
            <div>
              <h2>Model Provider Settings</h2>
              <p>Saved locally in this browser extension.</p>
            </div>
            <button id="settingsCloseBtn" type="button" class="iconButton secondary" aria-label="Close settings">x</button>
          </div>

          <div class="settingsPanelBody">
            <label for="llmApiKey">OpenAI API Key</label>
            <input id="llmApiKey" type="password" placeholder="sk-..." />

            <label for="anthropicApiKey">Anthropic API Key</label>
            <input id="anthropicApiKey" type="password" placeholder="sk-ant-..." />

            <label for="googleApiKey">Google AI API Key</label>
            <input id="googleApiKey" type="password" placeholder="AIza..." />

            <label for="localAgentMaxSteps">Max Agent Steps</label>
            <input id="localAgentMaxSteps" type="text" inputmode="numeric" placeholder="12" />

            <div class="buttonRow">
              <button id="saveSettingsBtn" type="button" class="secondary">Save</button>
            </div>

            <details class="debugDetails">
              <summary>Debug / Connection</summary>
              <div class="settingsInlineBody">
                <label for="pollEndpoint">OttoAuth Endpoint</label>
                <input id="pollEndpoint" type="text" placeholder="https://ottoauth.vercel.app/api/computeruse/device/next-task" />

                <label for="deviceId">Device ID (debug)</label>
                <input id="deviceId" type="text" placeholder="local-device-1" />

                <label class="rowInline">
                  <input id="liveListenEnabled" type="checkbox" />
                  <span>Live listen (long-poll)</span>
                </label>

                <button id="saveConnectionBtn" type="button" class="secondary">Save Connection</button>
              </div>
            </details>
          </div>
        </div>
      </section>
    </main>
    <script src="sidepanel.js"></script>
  </body>
</html>
